<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/stylesSecundario.css">
    <meta property="og:type" content="website">
    <meta property="og:url" content="" id="ogUrl"> <!-- URL dinámica -->
    <meta property="og:title" content="" id="ogTitle"> <!-- Título dinámico -->
    <meta property="og:description" content="" id="ogDescription"> <!-- Descripción dinámica -->
    <meta property="og:image" content="" id="ogImage"> <!-- Imagen dinámica -->
</head>    
<body>
    <div id="informacionLibro" class="libro-container">
        <h2 id="nombreLibro"></h2>
        <p id="resumenLibro"></p>
        <div id="botonesContenido" class="botones-contenido">
            <button id="btnAnime">Anime</button>
            <button id="btnManga">Manga</button>
            <button id="btnNovela">Novela</button>
            <button id="btnPelicula">Película</button>
            <button id="btnDoujinshi">Doujinshi</button>
        </div>
    </div>
    <img src="" id="imagenLibro" class="imagen-fondo">
    <div id="pdfButtons" class="pdf-buttons-container buttons-row"></div>
    <script type="module">
        import { librosNovela } from '../Data/dataNovela.js';

        function buscarLibroPorId(idLibro) {
            return librosNovela.find(libro => libro.id === idLibro);
        }

        document.addEventListener('DOMContentLoaded', async function () {
            const urlParams = new URLSearchParams(window.location.search);
            const idLibro = urlParams.get('id');
            const libro = buscarLibroPorId(idLibro);
            mostrarInformacionLibro(libro);
            mostrarContenido('ContenidoAnime', libro);
        });

        function mostrarInformacionLibro(libro) {
            // Rellenar la información del libro
            document.getElementById('nombreLibro').textContent = libro.nombre;
            document.title = libro.nombre;
            let imagenLibro = document.getElementById('imagenLibro');
            const googleDriveId = libro.imagenInterior;
            imagenLibro.src = `https://lh3.googleusercontent.com/d/${googleDriveId}`;
            imagenLibro.alt = libro.nombre;
            document.getElementById('resumenLibro').textContent = libro.resumen;
        
            // Rellenar las metaetiquetas Open Graph
            document.getElementById('ogUrl').content = window.location.href; // La URL actual
            document.getElementById('ogTitle').content = libro.nombre; // Título del libro
            document.getElementById('ogDescription').content = libro.resumen; // Descripción del libro
            document.getElementById('ogImage').content = `https://lh3.googleusercontent.com/d/${googleDriveId}`; // Imagen de Google Drive
        
            configurarBotones(libro);
        }
        

        function configurarBotones(libro) {
            document.getElementById('btnAnime').addEventListener('click', function () {
                mostrarContenido('ContenidoAnime', libro);
            });
            document.getElementById('btnManga').addEventListener('click', function () {
                mostrarContenido('ContenidoManga', libro);
            });
            document.getElementById('btnNovela').addEventListener('click', function () {
                mostrarContenido('ContenidoNovela', libro);
            });
            document.getElementById('btnPelicula').addEventListener('click', function () {
                mostrarContenido('ContenidoPelicula', libro);
            });
            document.getElementById('btnDoujinshi').addEventListener('click', function () {
                mostrarContenido('ContenidoDoujinshi', libro);
            });
        }

        let currentIndex = 0;

        function mostrarContenido(tipoContenido, libro) {
            const pdfButtonsContainer = document.getElementById('pdfButtons');
            pdfButtonsContainer.innerHTML = '';
        
            let maxVisibleItems;
        
            if (tipoContenido === 'ContenidoManga') {
                maxVisibleItems = 6;
                pdfButtonsContainer.classList.remove('anime-style');
                pdfButtonsContainer.classList.add('manga-style');
            } else {
                maxVisibleItems = 8;
                pdfButtonsContainer.classList.remove('manga-style');
                pdfButtonsContainer.classList.add('anime-style');
            }
        
            const contenidoSeleccionado = libro[tipoContenido];
            const items = Object.keys(contenidoSeleccionado).map(clave => {
                const { numero, codigo, texto, imagen } = contenidoSeleccionado[clave];
                return crearPdfButton(numero, codigo, texto, imagen, tipoContenido.replace('Contenido', ''), clave);
            });
        
            function actualizarBotones() {
                pdfButtonsContainer.innerHTML = '';
                const visibleItems = items.slice(currentIndex, currentIndex + maxVisibleItems);
                visibleItems.forEach(item => pdfButtonsContainer.appendChild(item));
            }
            actualizarBotones();
        }

        function crearPdfButton(numero, codigo, texto, imagenSrc, tipoContenido, clave) {
            const divContenido = document.createElement('div');
            divContenido.classList.add('pdf-button');
        
            const img = document.createElement('img');
            const googleDriveId = imagenSrc;
            img.src = `https://lh3.googleusercontent.com/d/${googleDriveId}`;
            img.alt = tipoContenido;
        
            const nombreDiv = document.createElement('div');
            nombreDiv.textContent = clave;
            nombreDiv.classList.add('button-name');
        
            const textoDiv = document.createElement('div');
            textoDiv.textContent = texto; // Contiene el texto del capítulo
            textoDiv.classList.add('texto-capitulo');
            textoDiv.style.display = 'none'; // Inicialmente oculto
        
            const imagenCapitulo = document.createElement('img');
            imagenCapitulo.src = `https://lh3.googleusercontent.com/d/${googleDriveId}`; // Usar la misma imagen
            imagenCapitulo.alt = tipoContenido;
            imagenCapitulo.classList.add('imagen-capitulo');
            imagenCapitulo.style.display = 'none'; // Inicialmente oculto
        
            divContenido.appendChild(img);
            divContenido.appendChild(nombreDiv);
            divContenido.appendChild(textoDiv);
        
            divContenido.addEventListener('click', function () {
                switch (numero) {
                    case 1:
                        window.location.href = `./genericoVideo.html?idArchivo=${codigo}&valor=${numero}`;
                        break;
                    case 2:
                        window.location.href = `./genericoLectura.html?idArchivo=${codigo}&valor=${numero}`;
                        break;
                    case 3:
                        window.location.href = `./genericoLectura.html?idArchivo=${codigo}&valor=${numero}`;
                        break;
                    case 4:
                        window.location.href = `./genericoVideo.html?idArchivo=${codigo}&valor=${numero}`;
                        break;
                    case 5:
                        window.location.href = `./genericoLectura.html?idArchivo=${codigo}&valor=${numero}`;
                        break;
                }
            });
        
            divContenido.addEventListener('mouseenter', function () {
                imagenCapitulo.style.display = 'block'; // Mostrar la imagen al pasar el mouse
                textoDiv.style.display = 'block'; // Mostrar el texto al pasar el mouse
            });
        
            divContenido.addEventListener('mouseleave', function () {
                imagenCapitulo.style.display = 'none'; // Ocultar la imagen al salir el mouse
                textoDiv.style.display = 'none'; // Ocultar el texto al salir el mouse
            });
        
            return divContenido;
        }
        
    </script>
</body>
</html>
